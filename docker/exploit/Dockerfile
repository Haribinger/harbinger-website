FROM python:3.12-slim

RUN apt-get update && apt-get install -y --no-install-recommends \
    bash \
    curl \
    wget \
    jq \
    git \
    nmap \
    netcat-openbsd \
    openssl \
    ca-certificates \
    ruby \
    ruby-dev \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Install Python exploit tools
RUN pip install --no-cache-dir \
    pwntools \
    impacket \
    crackmapexec \
    jwt-tool

# Install WPScan
RUN gem install wpscan --no-document || true

# Create non-root user
RUN useradd -m -s /bin/bash harbinger
USER harbinger
WORKDIR /home/harbinger

RUN mkdir -p /home/harbinger/output

LABEL maintainer="harbinger" \
      description="Harbinger Exploit Agent - impacket, crackmapexec, wpscan" \
      harbinger.agent="forge"

ENTRYPOINT ["/bin/bash", "-c"]
